<div th:fragment="subfragment" class="page-wrapper">
  <div class="container py-4" ng-controller="product-ctrl">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Sản phẩm</h3>
      </div>
      <div class="card-body border-bottom py-3">
        <div class="d-flex">
          <div class="text-muted">
            Hiển thị
            <div class="mx-2 d-inline-block">
              <input type="text" class="form-control form-control-sm text-center" ng-model="items.length" size="3"
                aria-label="Invoices count" disabled>
            </div>
            sản phẩm
          </div>

          <div class="ms-auto text-muted d-flex justify-content-center">
            <!-- this is filter products -->
            <input type="text" ng-model="getItems" class="form-control me-3"
              placeholder="Nhập từ khóa tìm kiếm sản phẩm ..." style="width: 350px;">

            <!-- this is button to open form -->
            <button class="btn btn-success d-none d-sm-inline-block" data-bs-toggle="modal"
              data-bs-target="#modal-product-add" style="text-decoration: none;">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24"
                stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              Thêm sản phẩm
            </button>



            <button class="btn btn-primary ms-2 d-none d-sm-inline-block" data-bs-toggle="modal"
              data-bs-target="#modal-voucher-add" style="text-decoration: none;">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-magic me-2" viewBox="0 0 16 16">
                <path d="M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0v1.829Zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707L14 2.707ZM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707L7.293 4Zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1h1.829Zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1h1.829ZM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707L13.293 10ZM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0v1.829Zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0L8.354 9.06Z"/>
              </svg>
              Thêm giảm giá
            </button>
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-hover table-borderless">
          <thead>
            <tr>
              <th class="w-1"></th>
              <th class="w-1">Id.
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm text-dark icon-thick" width="24" height="24"
                  viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                  stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                  <polyline points="6 15 12 9 18 15" />
                </svg>
              </th>
              <th>Tên sản phẩm.</th>
              <th>Hình ảnh.</th>
              <th>Số lượng.</th>
              <th>Giá cả.</th>
              <th>Ngày tạo ra.</th>
              <th>Trạng thái.</th>
              <th>Loại hàng.</th>
              <th></th>
            </tr>
          </thead>
          <tbody>

            <!-- this is tr -->
            <tr ng-repeat="item in items | filter : getItems | orderBy : 'name'">
              <td></td>
              <td><span class="text-muted">{{ item.id }}</span></td>
              <td class="text-reset">{{ item.name }}</td>
              <td>
                <img class="bg-white" src="/dist/img/products/{{item.image}}" width="37px" height="37px"
                  style="margin-right: 10px;">
                <a href="/user/detail/{{item.id}}">{{ item.image }}</a>
              </td>
              <th>{{ item.number }}</th>
              <td>
                <strong style="font-weight: bolder;">$</strong> {{ item.price }}
              </td>
              <td>
                {{ item.createDate | date:'dd-MM-yyyy'}}
              </td>
              <td>
                <span
                  class="badge bg-{{item.number != 0 && item.category.status != false ? 'success' : 'danger'}} me-1"></span>
                {{ item.number != 0 && item.category.status != false ? 'Còn bán' : 'Hết bán' }}
              </td>
              <td> {{ item.category.name }} </td>
              <td class="text-end">

                <!-- this is edit -->
                <a ng-click="edit(item.id)" class="btn btn-default d-none d-sm-inline-block" data-bs-toggle="modal"
                  data-bs-target="#modal-product" style="text-decoration: none;">
                  Open Detail
                </a>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>





    <!-- modal add product -->
    <div class="modal modal-blur fade" id="modal-product-add" tabindex="-1" role="dialog" aria-hidden="true"
      style="transition: 0.2s;">
      <div class="modal-dialog modal-lg" role="document">
        <form method="post" class="modal-content" action="/staff/products/add" enctype="multipart/form-data"
          th:object="${productDTO}">
          <div class="modal-header">
            <h5 class="modal-title">Chi tiết sản phẩm</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Tên sản phẩm</label>

              <!-- this is model name of form product -->
              <input type="text" class="form-control text-primary" min="10" name="example-text-input"
                placeholder="Nhập tên sản phẩm ..." autocomplete="off" th:field="*{name}" required>
            </div>
            <label class="form-label">Nhập thêm số lượng</label>
            <div class="form-selectgroup-boxes row mb-3">
              <div>
                <input type="number" min="1" class="form-control ps-2" placeholder="Nhập số số lượng ..."
                  autocomplete="off" th:field="*{number}" required>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-8">
                <div class="mb-3">
                  <label class="form-label">Giá sản phẩm</label>
                  <div class="input-group input-group-flat">

                    <!-- this is price of product -->
                    <input type="number" class="form-control ps-2" autocomplete="off" min="1"
                      placeholder="Nhập giá sản phẩm ..." th:field="*{price}" required>
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="mb-3">
                  <label class="form-label">Thể loại sản phẩm</label>

                  <!-- this is category -->
                  <select class="form-select" th:field="*{category}">
                    <option th:each="c : ${categories}" th:value="${c.id}">[[${c.name}]]</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-6">
                <div class="mb-3">
                  <label class="form-label">Chọn ảnh</label>

                  <!-- this is file -->
                  <input type="file" class="form-control" id="productImage" name="productImage"
                    accept="image/jpeg, image/png, image/jpg">
                  <img src="#" id="imgPreview" height="100px" width="100px"
                    th:src="@{${'/dist/img/products/' + productDTO.imageName}}" style="margin-top: 20px" alt=" ">
                  <input type="hidden" name="imgName" th:value="${productDTO.imageName}">
                </div>
              </div>
              <div class="col-lg-6">
                <div class="mb-3">
                  <label class="form-label">Ngày thêm sản phẩm</label>

                  <!-- this is date -->
                  <input type="text" class="form-control" value="{{now | date:'dd/MM/yyyy'}}" readonly>
                </div>
              </div>
            </div>
          </div>

          <!-- this is for edit to update and delete -->
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-ballpen" width="24"
                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M14 6l7 7l-4 4"></path>
                <path
                  d="M5.828 18.172a2.828 2.828 0 0 0 4 0l10.586 -10.586a2 2 0 0 0 0 -2.829l-1.171 -1.171a2 2 0 0 0 -2.829 0l-10.586 10.586a2.828 2.828 0 0 0 0 4z">
                </path>
                <path d="M4 20l1.768 -1.768"></path>
              </svg>
              Lưu trữ
            </button>
          </div>
        </form>
      </div>
    </div>



    <!-- modal add voucher -->
    <div class="modal modal-blur fade" id="modal-voucher-add" tabindex="-1" role="dialog" aria-hidden="true"
      style="transition: 0.2s;">
      <div class="modal-dialog modal-lg" role="document">
        <form method="post" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Áp mã giảm giá</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">

            <div class="mb-3">
              <label class="form-label">Tên sản phẩm</label>
              <!-- this is model name of form product -->
              <select class="form-select" ng-change="readURL_product()" id="productImageVoucher" ng-model="model_discount.productId">
                <option value="" disabled selected>-- Chọn sản phẩm --</option>
                <option ng-repeat="product in items" value="{{product.id}}">
                  {{product.name}}
                </option>
              </select>
              <span class="error fs-5" id="eror_free_1">(*) Vui lòng chọn một sản phẩm !</span>
            </div>

            <div class="mb-3">
              <label class="form-label">Mã giảm giá</label>
              <!-- this is model name of form product -->
              <select class="form-select" ng-change="readURL_discount()" id="discountImageVoucher" ng-model="model_discount.discountId">
                <option value="" disabled selected>-- Chọn giảm giá --</option>
                <option ng-repeat="discount in discounts" value="{{discount.id}}">
                  {{discount.id}}
                </option>
              </select>
              <span class="error fs-5" id="eror_free_2">(*) Vui lòng chọn một mã giảm giá !</span>

            </div>


            <!-- <div class="mb-3 bg-white border p-2">
              <img id="productImage_" class="col-3" alt="">

              <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
              </svg>

              <img id="discountImage_" class="col-3" alt="">
            </div> -->
          </div>

          <!-- this is for edit to update and delete -->
          <div class="modal-footer">
            <img src="" alt="">
            <button type="submit" ng-click="addvoucher()" class="btn btn-success">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-ballpen" width="24"
                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M14 6l7 7l-4 4"></path>
                <path
                  d="M5.828 18.172a2.828 2.828 0 0 0 4 0l10.586 -10.586a2 2 0 0 0 0 -2.829l-1.171 -1.171a2 2 0 0 0 -2.829 0l-10.586 10.586a2.828 2.828 0 0 0 0 4z">
                </path>
                <path d="M4 20l1.768 -1.768"></path>
              </svg>
              Hoàn tất giảm giá
            </button>
          </div>
        </form>
      </div>
    </div>









    <!-- model edit and stop sale -->
    <!-- this is modal -->
    <div class="modal modal-blur fade" id="modal-product" tabindex="-1" role="dialog" aria-hidden="true"
      style="transition: 0.2s;">
      <div class="modal-dialog modal-lg" role="document">
        <form method="post" class="modal-content" th:object="${product}">
          <div class="modal-header">
            <h5 class="modal-title">Chi tiết sản phẩm</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Tên sản phẩm</label>

              <!-- this is model name of form product -->
              <input type="text" ng-model="form.name" th:field="*{name}" class="form-control text-primary"
                name="example-text-input" placeholder="Nhập tên sản phẩm ...">
            </div>
            <label class="form-label">Nhập thêm số lượng</label>
            <div class="form-selectgroup-boxes row mb-3">
              <div>
                <input type="number" ng-model="form.number" min="1" th:field="*{number}" class="form-control ps-2"
                  autocomplete="off" required>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-8">
                <div class="mb-3">
                  <label class="form-label">Giá sản phẩm</label>
                  <div class="input-group input-group-flat">

                    <!-- this is price of product -->
                    <input type="number" ng-model="form.price" min="1" th:field="*{price}" class="form-control ps-2"
                      autocomplete="off" required>
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="mb-3">
                  <label class="form-label">Thể loại sản phẩm</label>

                  <!-- this is category -->
                  <select class="form-select" ng-model="form.category.id" th:field="*{category}">
                    <option th:each="c : ${categories}" th:value="${c.id}">[[${c.name}]]</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-6">
                <div class="mb-3">
                  <label class="form-label">Chọn ảnh</label>

                  <!-- this is file -->
                  <input type="file" class="form-control" ng-model="form.image" id="form-image" th:field="*{image}">
                </div>
              </div>
              <div class="col-lg-6">
                <div class="mb-3">
                  <label class="form-label">Ngày thêm sản phẩm</label>

                  <!-- this is date -->
                  <input type="date" class="form-control" ng-model="form.createDate" th:field="*{createDate}">
                </div>
              </div>
            </div>
          </div>

          <!-- this is for edit to update and delete -->
          <div class="modal-footer">
            <button type="submit" ng-click="update()" ng-if="open == 1" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-ballpen" width="24"
                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M14 6l7 7l-4 4"></path>
                <path
                  d="M5.828 18.172a2.828 2.828 0 0 0 4 0l10.586 -10.586a2 2 0 0 0 0 -2.829l-1.171 -1.171a2 2 0 0 0 -2.829 0l-10.586 10.586a2.828 2.828 0 0 0 0 4z">
                </path>
                <path d="M4 20l1.768 -1.768"></path>
              </svg>
              Cập nhật
            </button>
            <button type="submit" ng-click="delete(form.id)" ng-if="open == 1" class="btn btn-danger">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24"
                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <rect x="3" y="4" width="18" height="4" rx="2"></rect>
                <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10"></path>
                <line x1="10" y1="12" x2="14" y2="12"></line>
              </svg>
              Ngừng bán
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // this is function to get src of image when staff upload image
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          $('#imgPreview').attr('src', e.target.result).width(100).height(100);
        }
        reader.readAsDataURL(input.files[0])
      }
    }
    $('#productImage').change(function () {
      readURL(this);
    });
    

    // -------------------------------------
    $(".custom-file-input").on("change", function () {
      var fileName = $(this).val().split("\\").pop();
      $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
  </script>
</div>
</div>